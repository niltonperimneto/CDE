CDE Printing Widgets and APIsprintinggeneral informationCDE users typically print files through a series of dialogs,
the first one being initiated by selecting (for example) the
pulldown menu for printing a file. This chapter documents a set
of dialogs provided by CDEnext for use primarily by applications
that perform X printing:The initial print dialog is provided as
theDtPrintSetupBoxwidget. This consists of the set of generic
print options, a possible application-specific set of print
options, and a set of command buttons at the bottom to start or
cancel the print operation, bring up the Print Dialog Manager (PDM), or bring up a help
dialog.TheDtPrinterSelectionDialogis for selecting
X Printers and is accessible through theDtPrintSetupBoxwidget.A dialog for obtaining additional printer information, theDtPrinterInfoDialog, is accessible through either theDtPrintSetupBoxor theDtPrinterSelectionDialog.There is also a file selection dialog (accessible throughDtPrintSetupBox)
that enables users to select files to be printed. All of these sub-dialogs
are considered part of theDtPrintSetupBoxwidget, and
as such, there is no external API for them.AlthoughDtPrintSetupBoxis designed primarily for X printing,
it is also designed for use as a general application
print dialog for use in any CDEnext application that provides printing.DtPrintSetupBoxis also designed to allow simple
integration with the Print Dialog Manager, which
provides additional printer and spooler specific
X printing setup dialogs.The remaining sections of this chapter document the
DtPrint convenience functions, the DtPrint Dialog Manager, and how to integrate help
with the printing widgets.DtPrint Functionsprintingdtprint functionsdtprint functionsThis section summarizes DtPrint functions. Sample code
illustrating their use can be found in the/proj/cde/examples/dtprintdirectory.DtPrintSetupBoxDtPrintSetupBoxis a widget that is typically the initial window used to set various options prior to printing from an application. This widget is primarily designed for use by applications that utilize the X Print Service. However, the widget interface is also designed to be flexible enough for use by applications employing other printing methods.DtCreatePrintSetupBoxDtCreatePrintSetupBoxis a convenience function that creates an unmanaged instance of aDtPrintSetupBoxwidget, and returns its widget ID.DtCreatePrintSetupDialogDtCreatePrintSetupDialogis a convenience function that creates an instance of a dialog containing aDtPrintSetupBoxwidget, and returns theDtPrintSetupBoxwidget ID.DtPrintFillSetupDataDtPrintFillSetupDatais used to obtain an X printer connection in order to
initiate an X printing job in situations other than direct interaction with aDtPrintSetupBox(for example, a "quick print" button on a toolbar). This printer
connection information can be obtained from an existingDtPrintSetupBoxwidget instance, or if aDtPrintSetupBoxwidget instance is unavailable,DtPrintFillSetupDatawill provide a new X printer connection.DtPrintCopySetupDataDtPrintCopySetupDatais used to copy aDtPrintSetupDatastructure. An element in the target is updated only if different from the corresponding element in the source. For elements that point to allocated memory,DtPrintCopySetupDataallocates new memory for those elements updated in target. Existing elements in target are freed.
All elements in aDtPrintSetupDatastructure can be freed by callingDtPrintFreeSetupData.DtPrintFreeSetupDataFree the memory pointed to byDtPrintSetupDatastructure elements.DtPrintResetConnectionDtPrintResetConnectionis a convenience function provided by theDtPrintSetupBoxwidget that allows applications to direct the
widget to stop managing the X print server connection. A mode
parameter is included in order to direct the widget to close the
print connection or simply to relinquish
control of the connection without closing it.DtPrintResetConnectionis intended to be used by
applications that fork a child process to perform
the print rendering operation. Immediately after the
fork is performed, the parent process closes its
X print server connection and retains its connection to
the video X server. The forked child, on the other hand,
closes its video X server connection and performs the
rendering operation on the X print server connection.DtPrintSetupProcDtPrintSetupProcis a type definition for
procedure resources of theDtPrintSetupBoxwidget.DtPrinterSelectionDialogTheDtPrinterSelectionDialogenables the user to select an
X printer from a complete list of printers for the client server (provided
the server supports the Xp extension), plus each server indicated by either theXpServerListresource or theXPSERVERLISTenvironment variable. The user
typically selects one of the printers and chooses the "OK" button to return the selected printer to the caller.Print Dialog Managerprintingprint dialog managerPrint Dialog ManagerA Print Dialog Manager (PDM) is a process separate from the
X Print Server and X Printing Application that provides
printer-specific and spooler-specific setup GUIs.
An application could choose to understand and display
such GUIs itself, but is advised to offload the task
to a PDM so that new printers and spoolers can be
supported by providing new PDMs, rather than requiring
changes to all applications.This section describes the CDEnext
implementation of a PDM that uses the PDM
Selection Protocol. The CDEnext implementation involves
a Print Dialog Manager Daemon (PDMD) executable
(dtpdmd) that is initially engaged by the protocol.
It then determines which PDM is needed and starts
it on behalf of the application. Within CDEnext, the
executabledtpdmis the general purpose PDM that thedtpdmdcan start.Printer vendors can choose to introduce new GUIs by
one of the following techniques:Developing their own PDM implementation that conforms to
the PDM Selection Protocol.Develop a PDM that can be started by thedtpdmd; this is the recommended technique.Possibly integrate new shared or dynamic libraries into thedtpdmd. This technique is vendor-dependent.Thedtpdmexecutable implements a reasonably
general-purpose print dialog manager capable of providing
dialogs suitable for a number of different printers, but is
specifically tuned to the needs of the two reference
printers, the PCL based HP DeskJet 1600C, and the
Postscript based Sun SPARCprinter 2. Thedtpdmuses the
attributes of the particular printer
to provide a limited amount of automatic configuration of the options
displayed in its printer setup dialog. Thedtpdm's job setup dialog
is designed for use with the lp spooler.Thedtpdmdexecutable implements a PDM startup mechanism.
This two-layer mechanism means that the PDM Selection Protocol,
PDM selection and startup, and security concerns can be dealt with
by thedtpdmd, and that resulting PDMs called by thedtpdmdare
left with the minimal and simple task of displaying GUIs.Dt Print Dialog Manager Daemon &mdash; dtpdmdprintingdtprint dialog manager daemondtpdmdThedtpdmdis a long-lived daemon process that receives
client requests for a PDM, uses some lookup rules, and then
starts an appropriate PDM to service the request. When the
PDM finishes, control is returned to thedtpdmd, and thedtpdmdin turn responds to the client with final status.Thedtpdmduses the
PDMD/PDM Protocol to communicate with the
PDM. Communication "to" the PDM is done via a
standardized command line. Communication "from"
the PDM is done via standardized exit codes.Dt Print Dialog Managerprintingdtprint dialog managerdtpdmThe dialog manager is a process separate from the
print server. It provides the printer-specific GUIs
on behalf of a printing application
At an application's request,dtpdmposts to the
user's display a set of printer-specific dialogs enabling
the user to set printer specific and
job specific options. Though the setup dialog appears to be
part of the application, it is actually managed by thedtpdmprogram on behalf of the application. It is capable of
providing dialogs in all locales for which there are applicable
message catalogs.dtpdmpresents a dialog containing anXmNotebookwidget. This notebook widget contains two tabs: one for the
Printer Setup Box and one for the Job Setup Box. Each of these
boxes provide controls that allow for configuration of various
printing options. Thedtpdmdialog also contains three pushbuttons
labelled: "OK", "Cancel", and "Help". When the "OK" button is
activated, the dialog is dismissed and the newly configured
printing options are set in the current print context (viaXpSetAttributes).
When the "Cancel" button is activated, the dialog is dismissed and no
changes are made to the print context.Help for CDE Printing Widgetsprintingintegrating helpTheDtPrintSetupBoxwidget provides built-in support for its
sub-dialogs. That is, when the user clicks on the Help button in
one of these sub-dialogs, a help dialog is displayed containing the
relevant help text. The help volume and location IDs used for this purpose are
as follows:Printer Info &mdash; HelpVolume =LibDtPrint, LocationId =PrinterInfoPrinter Selection &mdash; HelpVolume =LibDtPrint, LocationId =SelectPrinterFile Selection &mdash; HelpVolume =LibDtPrint, LocationId =SelectFileFor the main dialog, however, no help dialog is automatically displayed
when the user presses the Help button. However, theDtPrintSetupBoxdoes provides the hooks that enable the application writer to easily
supply help for both the generic and the application-specific portions.
These hooks include:A "public"DtPrintSetupBoxhelp volume with one or more location IDs
for the generic printing options.An activation callback installed on theDtPrintSetupBoxHelp
button that ensures that anyXmNhelpCallbacks installed on
theDtPrintSetupBoxby the application are called.In order to integrate help for theDtPrintSetupBoxinto an application,
you must:Supply a help volume containing help for the relevant topics.
Note that if there are no application-specific printing options,
the public help volume supplied with theDtPrintSetupBoxwill
suffice. Otherwise, the authors of the application's help volume
will need to supply internal links to theDtPrintSetupBoxvolume.
For example, the help volume for a calendar manager might look
something like this:Calendar Print Setup Dialog Box
       -------------------------------some graphicReport Type     Choose to print Day View, Week View, Month View, or
                       Year View, plus Appointment List or To Do List.

       From/To         The dates for which you want to print
                       calendar data. With the From and To SpinBox,
                       you can select ...
       See Also:

           * Generic Print optionslink1* To Print Your Appointment Listlink2* To Print Your To Do Listlink3wherelink1is a link to the "public"DtPrintSetupBoxhelp volume.Define a set of location IDs to mark the locations in the
application's help volume pertaining to printing. It is up
the application to determine how "fine grained" to make the IDs
(for example, one for the entire print setup dialog, or one for every print
option in the print setup dialog, or some other organization).
The more "fine grained" the location IDs, the more specific
the help that is displayed when supporting a help system that
allows users to select the item for which they want help.Define a callback that is added to theXmNhelpCallbackresource
of theDtPrintSetupBox. This callback would display aDtHelpDialogWidgetorDtHelpQuickDialogWidgetsetting theDtNhelpVolumeandDtNlocationIdresources appropriately.