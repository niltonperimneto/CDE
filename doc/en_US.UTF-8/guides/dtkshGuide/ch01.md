Introduction to Desktop KornShellDesktop KornShell(ldtkshdtkshdefinition) provides kshell scripts
with the means for easily accessing most of the existing Xt and Motif&trade;
functions.dtkshis based onksh-93dtkshrelationshipt to ksh-93ksh-93, which provides a powerful
set of tools and commands for the shell programmer, and which supports the
standard set of kshell programming commands.dtkshsupports all the features and commands provided
byksh-93. In addition,dtkshsupports
a large selection of thelibDtfunctions, most of the
widget-related Motif functions, a large subset of the Xt Intrinsics functions,
and a small subset of the Xlib functions. All the supported functions are
listed in Appendix A.supported functionsfunctionssupportedUsing Desktop KornShell to Create Motif ApplicationsThis section describes how to usedtkshto createMotif applicationsMotifapplications, Motifapplications. To successfully
usedtksh, you should have experience with Xlib, the Xt
Intrinsics, the Motif widgets, and KornShell programming. It is also helpful
to know the C programming language. If you are not familiar with any of
these, you should refer to the appropriate documentation. Even if you are
familiar with these systems, you should have access to the applicable man
pages for reference.In addition, your system should have these libraries:required linbrarieslibraries, requiredlibDtHelplibDtSvclibX11libXmlibXtlibttResourcesresourcesResources are widget variables that you use to define attributes such
as size, location, or color. Each widget usually has a combination of its
own resources, plus resources it inherits from higher level widgets. Xt
Intrinsics and Motif resource names consist of a prefix (XtNorXmN) followed by the base name. The first letter of
the base name isalwayslowercase, and the first letter
of subsequent words within the base name isalwaysuppercase.
The convention for resource names indtkshscripts is
to delete the prefix and use the base name. Thus, the resourceXmNtopShadowColorbecomestopShadowColor.XmNtopShadowColortopShadowColorSome Xt and Motif commands allow the shell script to pass in a variable
number ofparameters, variable numberparameters,
representing resource-value pairs. This is similar to the argument list passed
to the corresponding Xt or Motif C function. Examples include any of the
commands used to create a widget, plus theXtSetValuescommand. Indtksh, resources are specified by a string
with the following syntax:resource:valuewhereresourceis the name of the resource
andvalueis the value assigned to the resource.dtkshautomatically converts thevaluestring to an appropriate internal representation. For example:XtSetValues $WIDGET height:100 width:200 resizePolicy:RESIZE_ANY
XmCreateLabel LABEL $PARENT myLabel labelString:&rdquo;Close Dialog&rdquo;When you retrieve widget resource values usingXtGetValuesXtGetValues, the return
value is placed in an environment variable. Thus, unlike the Xt Intrinsics,
thedtkshversion ofXtGetValuesuses
a name:(environment) variable pair, rather than a name:value pair. For example:XtGetValues $WIDGET height:HEIGHT resizePolicy:POLICY
             sensitive:SENSITIVE
echo $HEIGHT
echo $POLICY
echo $SENSITIVEThe precedingdtkshsegment might produce this output:100
RESIZE ANY
TRUECertain types of resource values, including string tables and bit masks,
have special representation. For example, the List widget allows a string
table to be specified for both theitemsandselectedItemsresources. Indtksh, a string
table is represented as a comma-separated list of strings, which is similar
to how Motif treats them. When a resource that returns a string table is
queried usingXtGetValuesXtGetValues, the resulting value is a comma-separated set of strings.A resource that expects a bit mask value to be passed to it expects
the mask to be specified as a string composed of the various mask values
separated by the |(bar) character. When a resource that returns a bit mask
is queried, the return value is a string representing the enabled bits, separated
by the | character. For example, you could use the following command to set
themwmFunctionsVendorShellmwmFunctionsresource
for theVendorShellwidget class:XtSetValues mwmFunctions: MWM_FUNC_ALL|MWM_FUNC_RESIZEUnsupported Resourcesunsupported resourcesresourceunsupporteddtkshsupports most of the Motif resources. The
following lists unsupported resources. Resources with an * (asterisk) can
be specified at widget creation time by usingXtSetValuesXtSetValues, but can't be retrieved
usingXtGetValuesXtGetValues.All widget and gadget Classes:Any fontlist resource *Any pixmap resource *Composite:insertPositionchildrenCore:acceleratorstranslations*colormapXmText:selectionArrayselectionArrayCountApplicationShell:argvWMShell:iconWindowwindowGroupShell:createPopupChildrenProcXmSelectionBox:textAcceleratorsManager,Primitive, andGadgetSubclasses:userDataXmFileSelectionBox:dirSearchProcfileSearchProcqualifySearchDataProcdtksh app-defaults Fileapp-defaults fileThedtkshapp-defaultsfile,
namedDtkshDtksh, app-defaults file, is found in a location based on the following path
description:/usr/dt/app-defaults/<LANG>The only information contained in thisapp-defaultsfile is the inclusion of the standardDtbaseapp-defaultsfile. The following is a listing of thedtkshapp-defaultsfile:#include &ldquo;Dt&ldquo;The fileDtis also located in/usr/dt/app-defaults/<LANG>and is shown in the following listing.*foregroundThreshold: 70
!###
!#
!#  Help system specific resources
!#
!###

!#
!# Display Area Colors
!#
!#   These resources set the colors for the display area (where
!#   actual help text is displayed). The resources are complex
!#   because they have to override the standard color resources
!#   in all cases.
!#
*XmDialogShell.DtHelpDialog*DisplayArea.background: White
*XmDialogShell*XmDialogShell.DtHelpDialog*DisplayArea.background:
White
*XmDialogShell.DtHelpDialog*DisplayArea.foreground: Black
*XmDialogShell*XmDialogShell.DtHelpDialog*DisplayArea.foreground:
Black

!#
!# Menu Accelerators
!#
!#   The following resources establish keyboard accelerators
!#   for the most frequently accessed menu commands.
!#

*DtHelpDialogWidget*searchMenu.keyword.acceleratorText: Ctrl+I
*DtHelpDialogWidget*searchMenu.keyword.accelerator: Ctrl<Key>i
*DtHelpDialogWidget*navigateMenu.backTrack.acceleratorText: Ctrl+B
*DtHelpDialogWidget*navigateMenu.backTrack.accelerator: Ctrl<Key>b
*DtHelpDialogWidget*navigateMenu.homeTopic.acceleratorText: Ctrl+H
*DtHelpDialogWidget*navigateMenu.homeTopic.accelerator: Ctrl<Key>h
*DtHelpDialogWidget*fileMenu.close.acceleratorText:   Alt+F4
*DtHelpDialogWidget*fileMenu.close.accelerator: Alt<Key>f4Variable Valuesvariable valuesThis section describes the types of values for some of the variables
in adtkshapp-defaultsfile.Defined ValuesDefined ValuesThe C bindings of the interfaces to X, Xt and Motif include many nonstring
values that are defined in header files. The general format of such values
consists of anXtorXmprefix followed
by a descriptive name. For example, one of the constraint values for a child
of a form widget isXmATTACH_FORM. Equivalent values
are specified indtkshby dropping the prefix, just as
in a Motif defaults file:XmDIALOG_COMMAND_TEXTbecomesDIALOG_COMMAND_TEXTXtATTACH_FORMbecomesATTACH_FORMBoolean ValuesBoolean ValuesYou can specify a Boolean value as a parameter to adtkshcommand using the words True or False; case is not significant. A Boolean
result is returned as either True or False, using all lowercase letters.Return ValuesReturn ValuesGraphical commands indtkshfall into one of four
categories, based on the definition of the corresponding C function:The function is void and returns no values.
Example:XtMapWidget()The function is void, but returns one or more values
through reference parameters. Example:XmGetColors()The function returns a non-Boolean value. Example:XtCreateManagedWidget()The function returns a Boolean value. Example:XtIsSensitive()Category 1return valuecategory
1Adtkshcategory 1category 1 command follows the calling sequence of its corresponding
C function. The number and order of parameters can be determined by looking
at the standard documentation for the function. Example:XtMapWidget $FORMCategory 2return valuecategory
2Adtkshcategory 2category 2 command also generally follows the calling sequence
of its corresponding C function. It returns a value in an environment variable,
instead of passing a pointer to a return variable. Example:XmGetColors $FORM $BG FOREGROUND TOPSHADOW BOTTOMSHADOW SELECT
echo &ldquo;Foreground color = &ldquo; $FOREGROUNDCategory 3return valuecategory
3Adtkshcategory 3category 3 command differs slightly from its corresponding C
function. Where the C function returns its value as the value of the procedure
call, adtkshcommand requires an additional parameter.
This parameter is the name of an environment variable into which the return
value is to be placed. It is always the first parameter. Example:XmTextGetString TEXT_VALUE $TEXT_WIDGET
echo &ldquo;The value of the text field is &ldquo;$TEXT_VALUECategory 4return valuecategory
4Adtkshcategory 4category 4 command returns a value that can be used in a conditional
expression just as in C. If the C function also returns values through reference
variables (as in category 2), thedtkshcommand also uses
variable names for the corresponding parameters. Example:if XmIsTraversable $PUSH_BUTTON; then
echo &ldquo;The pushbutton is traversable&rdquo;
else
echo &ldquo;The pushbutton is not traversable&rdquo;
fiGenerally, the order and type of parameters passed to a command matches
those passed to the corresponding C function, except as noted for category
3 commands.Immediate Return Valuereturn valueimmediateimmediate return valueMany of thecategory 3category
3 commands return a single value using an environment variable specified
as the first parameter to the command (for these special commands, the first
parameter has the namevariable). If this
return value is immediately used in an expression, the special environment
variable &ldquo;-&ldquo; may be used in place of a variable name. Whendtkshencounters &ldquo;-&ldquo; as the name of the environment
variable in which the return value is to be returned, it instead returns
the result as the value of the command. This allows the shell script to
embed the command call in another command call. This feature only works
for commands that return a single value, and the value is returned in the
first parameter. For example:XtDisplay DISPLAY $FORM
XSync $DISPLAY truecan be replaced by the equivalent statement:XSync $(XtDisplay &ldquo;-&ldquo; $FORM) trueThe reference to$DISPLAYis replaced with the
value returned by the call toXtDisplay.This capability is available for all category 3 commands except those
that create a widget, those that return more than a single value, and those
whose first parameter is not a named variable. Commands that do not accept
&ldquo;-&ldquo; as the environment variable name include the following:XtInitialize()XtCreateApplicationShell()XtCreatePopupShell()XtCreateManagedWidget()XtCreateWidget()All commands of the form:XmCreate...()Most commands of the form:tt_...()Initializing the Xt IntrinsicsXt Intrinsicsinitializeinitialize
Xt IntrinsicsAdtkshscript must first initialize the Xt Intrinsics
before it can call any of the Xlib, Xt, Motif, orlibDtcommands. You accomplish this by invoking theXtInitializeXtInitializecommand, which returns
an application shell widget. As is true for alldtkshcommands that return a widget ID,XtInitializereturns
the widget ID in the environment variable that is the first argument. For
example, in:XtInitialize TOPLEVEL myShellName Dtksh $0 &ldquo;$@&rdquo;the widget ID is returned in the environment variableTOPLEVEL.dtkshprovides a defaultapp-defaultsfile, which is used if the call toXtInitializespecifies
an application class name ofDtksh. Thisapp-defaultsfile contains the standard set ofDtapplication default values, sodtkshapplications have
a consistent look with otherDtapplications.Creating Widgetswidgetcreatecreate widgetThere are several commands you can use to create widgets:XtCreateWidgetXtCreateWidgetCreates an unmanaged widget.XtCreateManagedWidgetXtCreateManagedWidgetCreates a managed widget.XtCreateApplicationShellXtCreateApplicationShellCreates an application shell.XtCreatePopupShellXtCreatePopupShellCreates a pop-up shell.XmCreate<widgettypes>Creates an unmanaged widget.There is a specific format for each of these commands that you must
follow. For example, suppose you want to create an unmanaged push button
widget as a child of the top-level widget. You can use eitherXtCreateWidgetorXmCreatePushButton. The formats
for these commands are:XtCreateWidgetvariable name widgetclass $parent [resource:value
...]XtCreateWidgetXmCreatePushButtonvariable $parent name [resource:value ...]XmCreatePushButtonThe actual commands to create a push button widget are:XtCreateWidget BUTTON button XmPushButton $TOPLEVEL
XmCreatePushButton BUTTON $TOPLEVEL buttonEach of the preceding commands do exactly the same thing: create an
unmanaged push button. Note that no resource values are set. Suppose that
you want the background color of the push button to be red, and the foreground
color to be black. You can set the values of these resources this way:XtCreateWidget BUTTON button XmPushButton $TOPLEVEL \
background:Red \
foreground:Black
XmCreatePushButton BUTTON $TOPLEVEL button\
background:Red \
foreground:BlackAll of the C functions that create a widget return awidgethandlehandlewidget ID, or ID. The correspondingdtkshcommands set an environment variable equal to the widget
ID. These are category 3 commands, so the first argument is the name of
the environment variable in which to return the widget ID. The widget ID
is an ASCII string used bydtkshto access the actual
widget pointer. Either of the following commands could be used to create
a new form widget; however, in each case the widget ID for the new form widget
is returned in the environment variableFORM:XtCreateManagedWidget
FORM name XmForm $PARENTXtCreateManagedWidgetXmCreateForm FORM $PARENT nameXmCreateFormAfter either of these commands, you can use$FORMto reference the new form widget. For example, you could use this command
to create a label widget within the new form widget:XmCreateLabel LABEL $FORM name\
labelString:&rdquo;Hi Mom&rdquo; \
CH_FORM \
leftAttachment:ATTACH_FORMXmCreateLabelThere is a special widget ID called NULL, provided for cases where
a shell script may need to specify a NULL widget. For example, to disable
thedefaultButtonresource for a form widget, use the
commandXtSetValues $FORM defaultButton:NULLUsing a CallbackcallbackA callback is a function or procedure that is executed when an event
or combination of events occurs. For example, a callback is used to achieve
the desired result when a push button is &ldquo;pressed.&rdquo; It is
easy for adtkshshell script to assign a command to be
activated whenever a particular callback is invoked for a widget. The command
could be as simple as a string of commands blocked together, or the name
of the shell function to invoke.Registering a Callbackcallbackregisterregister callbackAn application registers a callback with a widget to specify a condition
in which it is interested and to specify what action should occur when that
condition occurs. The callback is registered usingXtAddCallbackXtAddCallback. The
action can be any validdtkshcommand. For example:XtAddCallback $WIDGET activateCallback &ldquo;ActivateProc&rdquo;

XtAddCallback $WIDGET activateCallback \
              &ldquo;XtSetSensitive $BUTTON false&rdquo;Passing Data to a Callbackcallbackpass data toA callback needs to be passed context information, so it can determine
what condition led to its call. For a C procedure, this information is typically
passed in acallDatastructure. For example, a scale
widget invoking avalueChangedCallbackpasses an instance
of the following structure incallData:typedef struct {
 int reason;
 XEvent event;
 int value;
}XmScaleCallbackStruct;The C application's callback then does something like:if (scaleCallData->reason == XmCR_VALUE_CHANGED)
{
  eventType = scaleCallData->event->type;
  display = scaleCallData->event->xany.display;
}Similarly, when a callback is invoked indtksh, the
following special environment variable is set up before the callback command
executes:CB_WIDGETThis is set to the widget ID for the widget that is invoking the callback.CB_CALL_DATAThis is set to the address of thecallDatastructure
passed by the widget to the callback.TheCB_CALL_DATACB_CALL_DATAenvironment variable represents a pointer to a structure, and
access to its fields uses a syntax similar to that of C. Nested environment
variables are defined, named the same as the fields of the structure (but
all in uppercase), and a dot is used to indicate containment of an element
in a structure. Thus, the previous C code to access thecallDataprovided by the scale widget translates to:if [ ${CB_CALL_DATA.REASON} = &ldquo;CR_VALUE_CHANGED&rdquo; ]; then
 eventType=${CB_CALL_DATA.EVENT.TYPE}
 display=${CB_CALL_DATA.EVENT.XANY.DISPLAY}
fiThe same is true of the event structure within thecallDatastructure.For most callback structures, the shell script is able to reference
any of the fields defined for the particular callback structure, using the
technique described earlier. In most cases, the shell script is not able
to alter the values of the fields within these structures. The exception
to this is theXmTextVerifyCallbackStruct, which is available
during thelosingFocusCallback, themodifyVerifyCallbackand themotionVerifyCallbackfor the text widget.dtkshsupports the modification of certain fields within
this structure, to the extent that it is supported by Motif. The following
fields within the callback structure are capable of being modified:CB_CALL_DATA.DOITCB_CALL_DATA.STARTPOSCB_CALL_DATA.TEXT.PTRCB_CALL_DATA.TEXT.LENGTHCB_CALL_DATA.TEXT.FORMATThis is an example of how one of these fields can be modified:CB_CALL_DATA.DOIT=&rdquo;false&rdquo;CB_CALL_DATA.TEXT.PTR=&rdquo;*&rdquo;CB_CALL_DATA.TEXT.LENGTH=1