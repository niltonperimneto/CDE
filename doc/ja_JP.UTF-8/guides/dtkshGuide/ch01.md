デスクトップKornShellの紹介デスクトップ KornShell(ldtkshdtksh定義)は、ほとんどの既存のXtやMotif&trade;関数に簡単にアクセスするための手段をもつ
kshellスクリプトを提供します。dtkshは、ksh-93dtkshksh-93との関係ksh-93を基にしています。dtkshは、シェル・プログラマにとって有効なツールおよびコマンドのセットを
提供しており、標準的なkshellプログラミング・コマンドのセットをサポートしています。dtkshは、ksh-93が提供しているすべての機能およびコマンドを
サポートしています。dtkshは、libDt関数の数多くの選択、ウィジェット関連の
ほとんどのMotif関数、Xtイントリンシクスの多数のサブセット、Xlib関数の少数の
サブセットをサポートしています。サポートされている関数のすべてのリストは、付録Aに
記載されています。サポート関数関数サポート関数デスクトップKornShellでMotifアプリケーションを作成するにはこの節では、dtkshを使って、Motifアプリケーションを作成する方法Motifアプリケーション>Motifアプリケーションを説明します。dtkshをうまく使用するには、 Xlib、Xtイントリンシクス、Motifウィジェット、
およびKornShellプログラミングの経験は必要です。Cプログラミング言語について知っていることも役に
立ちます。これらを熟知していないときは、適切なドキュメントを参照して
ください。これらのシステムを熟知している場合も、適切なマニュアル・ページに
アクセスし、参照してください。システムには、以下のようなライブラリがあります。必要なライブラリ必要なライブラリlibDtHelplibDtSvclibX11libXmlibXtlibttリソースリソースリソースはサイズ、位置、またはカラーなどの属性を定義するのに使用するウィジェット
の変数です。通常、各ウィジェットがもつリソースは、自身のリソースにより高いレベル
のウィジェットから引き継ぐリソースを加えたものです。Xtイントリンシクス
およびMotifリソース名は接頭辞(XtNまたはXmN)の後にベース名が続く構成に
成っています。
ベース名の最初の文字は、常に小文字です。ベース名内の後続の単語の最初の文字は、常に大文字です。dtkshスクリプトのリソース名は、接頭辞を
削除して、残ったベース名を使用します。
例えばXmNtopShadowColorはtopShadowColorになります。いくつかのXtおよびMotifコマンドは、シェル・スクリプトがリソースとそのiリソース値のペアを表す
パラメータの変数を渡せます。パラメータの変数これは、引数のリストが、対応するXtまたはMotifのC言語の関数に渡される
のに似ています。例えば、コマンドのいくつかを使用してウィジェットを作成し、XtSetValuesコマンドを追加します。dtkshで、リソースは次の構文をもつ
文字列で指定されます。resource:valueresourceはリソース名、valueはリソースに割り当てられた値です。dtkshは、適切な内部表現にvalue文字列を自動的に変換します。例えば次のとおりです。XtSetValues $WIDGET height:100 width:200 resizePolicy:RESIZE_ANY
XmCreateLabel LABEL $PARENT myLabel labelString:&rdquo;Close Dialog&rdquo;XtGetValuesXtGetValuesを使用してウィジェットのリソース値を検索するとき、戻り値は、環境変数にi置かれます。
したがって、dtksh版のXtGetValuesは、
名前と値のペアではなく、名前と(環境)変数のペアを使用します(Xtイントリンシクスと異なります)。
例えば、次のとおりです。XtGetValues $WIDGET height:HEIGHT resizePolicy:POLICY
             sensitive:SENSITIVE
echo $HEIGHT
echo $POLICY
echo $SENSITIVE前述のdtkshセグメントは、次のような出力を行います。100
RESIZE ANY
TRUE文字テーブルおよびビット・マスクを含むあるタイプのリソース値は、特別な表現に
なります。例えば、リスト・ウィジェットは、文字テーブルに、itemsおよびselectedItemsの両方を指定できます。dtkshで、文字テーブルは、カンマで区切られた文字列のリストで表現されます。これ
は、Motifが文字テーブルを取り扱う方法と似ています。
文字テーブルを返すリソースをXtGetValuesXtGetValuesで問い合わせたとき、
その結果の値はカンマで区切られた文字列のセットになります。ビット・マスク値で渡されるリソースは、マスク値を|(バー)文字で区切られた様々な
マスク値から成る文字列として指定します。ビット・マスクを返すリソースを問い合わせ
たとき、戻り値は、|文字で区切られたビットを表現した文字列になります。例えば、VendorShellウィジェット・クラスのmwmFunctionsVendorShellmwmFunctionsリソースを設定するには次のコマンドを使用します。XtSetValues mwmFunctions: MWM_FUNC_ALL|MWM_FUNC_RESIZEサポートしていないリソースサポートしていないリソースリソースサポートしていないリソースdtkshは、ほとんどのMotifリソースをサポートしています。次のリストは、サポート
していないリソースです。 *(アスタリスク)のついたリソースは、XtSetValuesを使用して
ウィジェットを作成できますが、XtGetValuesXtGetValuesを使用して検索すること
はできません。すべてのウィジェットおよびガジェットのクラス:任意のfontlistリソース *任意のpixmapリソース *コンポジット:insertPositionchildrenコア:acceleratorstranslations*colormapXmText:selectionArrayselectionArrayCountアプリケーション・シェル:argvWMShell:iconWindowwindowGroupシェル:createPopupChildrenProcXmSelectionBox:textAcceleratorsマネージャ、プリミティブ、およびガジェットサブクラス:userDataXmFileSelectionBox:dirSearchProcfileSearchProcqualifySearchDataProcdtksh app-defaultsファイルapp-defaultsファイルdtkshのapp-defaultsファイルは、DtkshDtksh app-defaultsファイルという名前で、次のパス表示を基づいた位置にあります。/usr/dt/app-defaults/<LANG>このapp-defaultsファイルにある情報は、標準的なDtベースのapp-defaultsファイルに
含まれているもののみです。dtkshのapp-defaultsファイルのリストは次のとおりです。#include &ldquo;Dt&ldquo;Dtファイルは、/usr/dt/app-defaults/<LANG>にあり、次のようなリストで示されています。*foregroundThreshold: 70
!###
!#
!#  Help system specific resources
!#
!###

!#
!# Display Area Colors
!#
!#   These resources set the colors for the display area (where
!#   actual help text is displayed). The resources are complex
!#   because they have to override the standard color resources
!#   in all cases.
!#
*XmDialogShell.DtHelpDialog*DisplayArea.background: White
*XmDialogShell*XmDialogShell.DtHelpDialog*DisplayArea.background:
White
*XmDialogShell.DtHelpDialog*DisplayArea.foreground: Black
*XmDialogShell*XmDialogShell.DtHelpDialog*DisplayArea.foreground:
Black

!#
!# Menu Accelerators
!#
!#   The following resources establish keyboard accelerators
!#   for the most frequently accessed menu commands.
!#

*DtHelpDialogWidget*searchMenu.keyword.acceleratorText: Ctrl+I
*DtHelpDialogWidget*searchMenu.keyword.accelerator: Ctrl<Key>i
*DtHelpDialogWidget*navigateMenu.backTrack.acceleratorText: Ctrl+B
*DtHelpDialogWidget*navigateMenu.backTrack.accelerator: Ctrl<Key>b
*DtHelpDialogWidget*navigateMenu.homeTopic.acceleratorText: Ctrl+H
*DtHelpDialogWidget*navigateMenu.homeTopic.accelerator: Ctrl<Key>h
*DtHelpDialogWidget*fileMenu.close.acceleratorText:   Alt+F4
*DtHelpDialogWidget*fileMenu.close.accelerator: Alt<Key>f4変数の値変数の値この節は、dtkshapp-defaultsファイルの変数の値の型について説明します。定義値定義値X、XtおよびMotifに対するインタフェースのCバインディングは、文字列ではない値
(ヘッダ・ファイルで定義されている)を多く含んでいます。このような値の一般的な形式
は、XtまたはXm接頭辞の後に、説明的な名前が続く形式に
なっています。例えば、フォーム・ウィジェットの子の制約値の1つにXmATTACH_FORMが
あります。接頭辞を取り去ることによって、Motifデフォルト・ファイルで指定するのと
同等の値を、dtkshに指定できます。XmDIALOG_COMMAND_TEXTは、DIALOG_COMMAND_TEXTになります。XtATTACH_FORMは、ATTACH_FORMになります。ブール値ブール値dtkshコマンドのパラメータとしてTrueまたはFalseを使用してブール値を指定できます。
大文字、小文字は関係ありません。
結果は、trueまたはfalse(すべて小文字が使用されます。)のいずれかが返されます。戻り値戻り値dtkshのグラフィカル・コマンドは、対応するC関数の定義に基づいて、4つのカテゴリの
１つに分類されています。関数はvoidで、値を返しません。
例:XtMapWidget()関数はvoidですが、関連するパラメータを通して1つ以上の値を返します。
例:XmGetColors()関数はブール値以外の値を返します。
例:XtCreateManagedWidget()関数はブール値を返します。
例:XtIsSensitive()カテゴリ1戻り値カテゴリ1dtkshカテゴリ1のカテゴリ1のコマンドは、対応するC関数の呼び出しシーケンスに従います。パラメータの
数や順序は、関数の標準的なマニュアルを参照して決定してください。
例:XtMapWidget $FORMカテゴリ2戻り値カテゴリ2dtkshカテゴリ2のカテゴリ2のコマンドもまた、通常、対応するC関数の呼び出しシーケンスに従います。値を返す
ポインタを渡すかわりに環境変数で値を返します。
例:XmGetColors $FORM $BG FOREGROUND TOPSHADOW BOTTOMSHADOW SELECT
echo &ldquo;Foreground color = &ldquo; $FOREGROUNDカテゴリ3戻り値カテゴリ3dtkshカテゴリ3のコマカテゴリ3のコマンドは、対応するC関数とは少し異なります。C関数は、プロシージャ
呼び出しの値としてその値を返しますが、dtkshコマンドはパラメータの追加を要求
します。このパラメータは、戻り値が置かれる環境変数の名前です。常に最初のパラメータ
になります。
例:XmTextGetString TEXT_VALUE $TEXT_WIDGET
echo &ldquo;The value of the text field is &ldquo;$TEXT_VALUEカテゴリ4戻り値カテゴリ4dtkshカテゴリ4のカテゴリ4のコマンドは、C関数と同様の条件式で使用できる値を返します。
C関数が関連する値を通して(カテゴリ2と同様です)戻り値を返すと、dtkshコマンド、対応
するパラメータの変数名を使用します。
例:if XmIsTraversable $PUSH_BUTTON; then
echo &ldquo;The pushbutton is traversable&rdquo;
else
echo &ldquo;The pushbutton is not traversable&rdquo;
fi一般に、カテゴリ3コマンドで記述したものを除いて、コマンドに渡されるパラメータの
順番や型は、対応するC関数に渡されるものと一致します。直接戻り値戻り値直接戻り値直接戻り値多くのカテゴリ3カテゴリ3のコマンドは、コマンドの最初のパラメータで指定した環境変数を
使って、1つの値を返します(これらの特別なコマンドの最初のパラメータの名前はvariableです)。この戻り値が、直接、式で使用されるときは、特別な環境変数
ldquor;-&ldquor;を変数名の代わりに使用することがあります。戻り値が返される
環境変数の名前が&ldquor;-&ldquor;であるとき、dtkshは、コマンドの値と
して結果を返します。これにより、シェル・スクリプトはコマンド呼び出しを別の
コマンド呼び出しに含めることができます。この機能は、1つの値を返すコマンドに
のみ働き、その値は最初のパラメータに返されます。
例:XtDisplay DISPLAY $FORM
XSync $DISPLAY true上記は、次のように、同等の状態に置き換えることができます。XSync $(XtDisplay &ldquo;-&ldquo; $FORM) true$DISPLAYのリファレンスには、XtDisplayが返す値に置き換えられます。これは、ウィジェットを作成するコマンド、複数の値を返すコマンド、最初のパラメータ
が名前のない変数であるコマンドを除くすべてのカテゴリ3のコマンドで有効です。
環境変数名として&ldquor;-&ldquor;を受け入れないコマンドを以下に示します。XtInitialize()XtCreateApplicationShell()XtCreatePopupShell()XtCreateManagedWidget()XtCreateWidget()次の形式のすべてのコマンド:XmCreate...()次の形式のほとんどのコマンド:tt_...()Xtイントリンシクスの初期化Xtイントリンシクス初期化Xtイントリンシクスの初期化dtkshスクリプトは、Xlib、Xt、MotifまたはlibDtコマンドを
呼び出す前に、Xtイントリンシクスを初期化しなければなりません。
Xtイントリンシクスの初期化は、XtInitializeXtInitializeコマンドで行います。このコマンドは、
アプリケーション・シェル・ウィジェットを返します。ウィジェットIDを返すdtkshのコマンドのすべてがそうであるように、XtInitializeコマンドは、最初の引き数である
環境変数にウィジェットIDを返します。例えば、次のコマンドを実行します。XtInitialize TOPLEVEL myShellName Dtksh $0 &ldquo;$@&rdquo;環境変数TOPLEVELにウィジェットIDが返されます。dtkshはデフォルトのapp-defaultsファイルを提供します。このファイルは、XtInitializeを呼び出しに、Dtkshファイルを指定したとき、使用されます。app-defaultsファイルはDtアプリケーションのデフォルト値の標準セットを
含んでいます。そのため、dtkshアプリケーションは、他のDtアプリケーションとの
外見と調和します。ウィジェットの作成ウィジェット作成ウィジェットの作成ウィジェットを作成するのに使用できるコマンドを以下に示します。XtCreateWidgetXtCreateWidget管理されないウィジェットを作成します。XtCreateManagedWidgetXtCreateManagedWidget管理されるウィジェットを作成します。XtCreateApplicationShellXtCreateApplicationShellアプリケーション・シェルを作成します。XtCreatePopupShellXtCreatePopupShellポップアップ・シェルを作成します。XmCreate<widgettypes>管理されないウィジェットを作成します。これらのコマンドのそれぞれに、従わなければならない特別な形式をがあります。
例えば、トップレベル・ウィジェットの子として、管理されないプッシュ・ボタンを
作成したいとします。XtCreateWidgetまたはXmCreatePushButtonのどちらかを使用して
作成できます。これらのコマンドの形式は次のとおりです。XtCreateWidgetvariable name widgetclass $parent [resource:value
...]XtCreateWidgetXmCreatePushButtonvariable $parent name [resource:value ...]XmCreatePushButtonプッシュ・ボタン・ウィジェットを作成する実際のコマンドは次のとおりです。XtCreateWidget BUTTON button XmPushButton $TOPLEVEL
XmCreatePushButton BUTTON $TOPLEVEL button上記のそれぞれのコマンドは、同じ動作で管理されないプッシュ・ボタンを作成します。
リソース値は設定されていません。プッシュ・ボタンのバック・グラウンドのカラーを
赤、フォア・グラウンドのカラーを黒にしたいとします。リソース値のは次の方法で
設定します。XtCreateWidget BUTTON button XmPushButton $TOPLEVEL \
background:Red \
foreground:Black
XmCreatePushButton BUTTON $TOPLEVEL button\
background:Red \
foreground:Blackウィジェットを作成するすべてのC関数は、ウィジェット操作操作ウィジェットIDまたはIDを返します。対応するdtkshコマンドは、ウィジェットIDと同じ環境変数を設定します。
これらはカテゴリ3のコマンドのため、最初の引き数はウィジェットIDを返す環境変数
の名前です。ウィジェットIDは、dtkshを使用して実際のウィジェット
・ポインタにアクセスするためのASCII文字列です。次のコマンドの両方で、新規
フォーム・ウィジェットを作成できます。どちらの場合でも、新規フォーム・ウィジェット
のウィジェットIDが環境変数FORMに返されます。XtCreateManagedWidget
FORM name XmForm $PARENTXtCreateManagedWidgetXmCreateForm FORM $PARENT nameXmCreateFormこれらのコマンドのどちらかを実行後、$FORMを使用して新規
フォーム・ウィジェットを参照できます。例えば、次のコマンドで、新規
フォーム・ウィジェット内にラベル・ウィジェットを作成できます。XmCreateLabel LABEL $FORM name\
labelString:&rdquo;Hi Mom&rdquo; \
CH_FORM \
leftAttachment:ATTACH_FORMXmCreateLabelNULLウィジェットを指定する必要がある場合に使用する、NULLと呼ばれる特別なウィジェットIDがあります。します。例えば、フォーム・ウィジェット
のリソースdefaultButtonを無効にするには、次のコマンドを使用
します。XtSetValues$FORM defaultButton:NULLコールバックの使用コールバックコールバックは、１つのイベントまたは複数のイベントの組合せが生じたときに実行する
プッシュ・ボタン関数またはプロシージャです。例えば、コールバックは、プッシュ・
ボタンを&ldquor;押した&rdquor;ときに、期待する結果をだすために使用します。dtkshシェル・スクリプトで、特定のコールバックがウィジェットに呼び出されるためのコマンドを割り当てるのは容易です。
そのコマンドは、ブロックされたコマンドの文字列または呼び出すシェル関数の名前で
あり、単純なものです。コールバックの登録コールバック登録コールバックの登録アプリケーションは、関連のある状態を指定するウィジェット、その状態になった
ときに生じるアクションを指定するウィジェットでコールバックを登録します。
コールバックは、XtAddCallbackXtAddCallbackを使用して登録します。
アクションは任意の有効なdtkshコマンドになります。例えば次のとおりです。XtAddCallback $WIDGET activateCallback &ldquo;ActivateProc&rdquo;

XtAddCallback $WIDGET activateCallback \
              &ldquo;XtSetSensitive $BUTTON false&rdquo;コールバックにデータを渡すコールバックコールバックにデータを渡すコールバックには、コンテキスト情報を渡す必要があります。コンテキスト情報は、呼び出しまでの条件
を決定します。Cプロシージャの場合、この情報は、一般的にはcallData構造体に渡さ
れます。例えば、valueChangedCallbackを呼び出すスケール・ウィジェットは次の構造体をcallDataに渡します。typedef struct {
 int reason;
 XEvent event;
 int value;
}XmScaleCallbackStruct;Cアプリケーションのコールバックは次のようになります。if (scaleCallData->reason == XmCR_VALUE_CHANGED)
{
  eventType = scaleCallData->event->type;
  display = scaleCallData->event->xany.display;
}同様に、コールバックがdtkshで呼び出されたとき、コールバック・コマンドが実行される前に次の
環境変数が設定されます。CB_WIDGETこれは、コールバックを呼び出しているウィジェットのウィジェットIDに設定されます。CB_CALL_DATAこれは、コールバックに対してウィジュットによって渡されるcallData構造体のアドレスに設定さ
れます。CB_CALL_DATACB_CALL_DATA環境変数は構造体へのポインタのを表しており、そのフィールドへの
アクセスには、Cのアクセスと同様の構文を使用します。
入れ子式の環境変数が定義され、その構造体のフィールドと同様に名前(すべて大文字
です)がつけられます。構造体の要素の内容を示すのには、ドットが使用されます。
したがって、スケール・ウィジェットが提供するcallDataにアクセス
する上記のCコードは、次のように翻訳されます。if [ ${CB_CALL_DATA.REASON} = &ldquo;CR_VALUE_CHANGED&rdquo; ]; then
 eventType=${CB_CALL_DATA.EVENT.TYPE}
 display=${CB_CALL_DATA.EVENT.XANY.DISPLAY}
fi同じことが、callData構造体内のイベント構造体にもいえます。ほとんどのコールバック構造体に対して、シェルスクリプトは、特定のコールバック
構造体に定義されている任意のフィールドを、先に説明した技法を使用して参照する
ことができます。ほとんどの場合、シェル・スクリプトは、これらの構造体内のフィールド
の値を変更できません。この例外は、XmTextVerifyCallbackStructです。これは、テキスト
ウィジェットのlosingFocusCallback、modifyVerifyCallback、およびmotionVerifyCallbackで有効です。dtkshは、Motifによってサポートされている範囲で、この構造体内のフィールドを変更を
サポートしています。コールバック構造体の次のフィールドは、変更可能です。CB_CALL_DATA.DOITCB_CALL_DATA.STARTPOSCB_CALL_DATA.TEXT.PTRCB_CALL_DATA.TEXT.LENGTHCB_CALL_DATA.TEXT.FORMAT上記のフィールドは次のように変更できます。CB_CALL_DATA.DOIT=&rdquo;false&rdquo;CB_CALL_DATA.TEXT.PTR=&rdquo;*&rdquo;CB_CALL_DATA.TEXT.LENGTH=1